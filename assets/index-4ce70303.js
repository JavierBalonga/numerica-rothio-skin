import{g as Ve,c as he,a as He,j as g,u as Ae,r as A,b as Je,p as qe,d as Re}from"./index-739b7188.js";import{u as V}from"./index-80e37c57.js";var je={exports:{}};const Qe={},Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"})),le=Ve(Ze);var Oe={exports:{}};const Xe=/^\u0001ACTION ([^\u0001]+)\u0001$/,Ye=/^(justinfan)(\d+$)/,Ke=/\\([sn:r\\])/g,et=/([ \n;\r\\])/g,me={s:" ",n:"",":":";",r:""},fe={" ":"s","\n":"n",";":":","\r":"r"},tt=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),st=/[|\\^$*+?:#]/,ie=Oe.exports={get:(e,t)=>typeof e>"u"?t:e,hasOwn:(e,t)=>({}).hasOwnProperty.call(e,t),promiseDelay:e=>new Promise(t=>setTimeout(t,e)),isFinite:e=>isFinite(e)&&!isNaN(parseFloat(e)),toNumber(e,t){if(e===null)return 0;const s=Math.pow(10,ie.isFinite(t)?t:0);return Math.round(e*s)/s},isInteger:e=>!isNaN(ie.toNumber(e,0)),isRegex:e=>st.test(e),isURL:e=>tt.test(e),justinfan:()=>`justinfan${Math.floor(Math.random()*8e4+1e3)}`,isJustinfan:e=>Ye.test(e),channel(e){const t=(e||"").toLowerCase();return t[0]==="#"?t:"#"+t},username(e){const t=(e||"").toLowerCase();return t[0]==="#"?t.slice(1):t},token:e=>e?e.toLowerCase().replace("oauth:",""):"",password(e){const t=ie.token(e);return t?`oauth:${t}`:""},actionMessage:e=>e.match(Xe),replaceAll(e,t){if(e===null||typeof e>"u")return null;for(const s in t)e=e.replace(new RegExp(s,"g"),t[s]);return e},unescapeHtml:e=>e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC(e){return!e||typeof e!="string"||!e.includes("\\")?e:e.replace(Ke,(t,s)=>s in me?me[s]:s)},escapeIRC(e){return!e||typeof e!="string"?e:e.replace(et,(t,s)=>s in fe?`\\${fe[s]}`:s)},addWord:(e,t)=>e.length?e+" "+t:e+t,splitLine(e,t){let s=e.substring(0,t).lastIndexOf(" ");return s===-1&&(s=t-1),[e.substring(0,s),e.substring(s+1)]},extractNumber(e){const t=e.split(" ");for(let s=0;s<t.length;s++)if(ie.isInteger(t[s]))return~~t[s];return 0},formatDate(e){let t=e.getHours(),s=e.getMinutes();return t=(t<10?"0":"")+t,s=(s<10?"0":"")+s,`${t}:${s}`},inherits(e,t){e.super_=t;const s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e},isNode(){try{return typeof process=="object"&&Object.prototype.toString.call(process)==="[object process]"}catch{}return!1}};var se=Oe.exports;const ot=le,pe=se;var it=function(t,s){let o=t.url!==void 0?t.url:t.uri;if(pe.isURL(o)||(o=`https://api.twitch.tv/kraken${o[0]==="/"?o:`/${o}`}`),pe.isNode()){const r=Object.assign({method:"GET",json:!0},t);if(r.qs){const f=new URLSearchParams(r.qs);o+=`?${f}`}const l={};"fetchAgent"in this.opts.connection&&(l.agent=this.opts.connection.fetchAgent);const d=ot(o,{...l,method:r.method,headers:r.headers,body:r.body});let m={};d.then(f=>(m={statusCode:f.status,headers:f.headers},r.json?f.json():f.text())).then(f=>s(null,m,f),f=>s(f,m,null))}else{const r=Object.assign({method:"GET",headers:{}},t,{url:o}),l=new XMLHttpRequest;l.open(r.method,r.url,!0);for(const d in r.headers)l.setRequestHeader(d,r.headers[d]);l.responseType="json",l.addEventListener("load",d=>{l.readyState===4&&(l.status!==200?s(l.status,null,null):s(null,null,l.response))}),l.send()}};const y=se;function ge(e,t){return e=y.channel(e),t=y.get(t,30),this._sendCommand(null,e,`/followers ${t}`,(s,o)=>{this.once("_promiseFollowers",r=>{r?o(r):s([e,~~t])})})}function be(e){return e=y.channel(e),this._sendCommand(null,e,"/followersoff",(t,s)=>{this.once("_promiseFollowersoff",o=>{o?s(o):t([e])})})}function _e(e){return e=y.channel(e),this._sendCommand(null,null,`PART ${e}`,(t,s)=>{this.once("_promisePart",o=>{o?s(o):t([e])})})}function ve(e){return e=y.channel(e),this._sendCommand(null,e,"/r9kbeta",(t,s)=>{this.once("_promiseR9kbeta",o=>{o?s(o):t([e])})})}function we(e){return e=y.channel(e),this._sendCommand(null,e,"/r9kbetaoff",(t,s)=>{this.once("_promiseR9kbetaoff",o=>{o?s(o):t([e])})})}function ye(e,t){return e=y.channel(e),t=y.get(t,300),this._sendCommand(null,e,`/slow ${t}`,(s,o)=>{this.once("_promiseSlow",r=>{r?o(r):s([e,~~t])})})}function xe(e){return e=y.channel(e),this._sendCommand(null,e,"/slowoff",(t,s)=>{this.once("_promiseSlowoff",o=>{o?s(o):t([e])})})}var nt={action(e,t){return e=y.channel(e),t=`ACTION ${t}`,this._sendMessage(this._getPromiseDelay(),e,t,(s,o)=>{s([e,t])})},ban(e,t,s){return e=y.channel(e),t=y.username(t),s=y.get(s,""),this._sendCommand(null,e,`/ban ${t} ${s}`,(o,r)=>{this.once("_promiseBan",l=>{l?r(l):o([e,t,s])})})},clear(e){return e=y.channel(e),this._sendCommand(null,e,"/clear",(t,s)=>{this.once("_promiseClear",o=>{o?s(o):t([e])})})},color(e,t){return t=y.get(t,e),this._sendCommand(null,"#tmijs",`/color ${t}`,(s,o)=>{this.once("_promiseColor",r=>{r?o(r):s([t])})})},commercial(e,t){return e=y.channel(e),t=y.get(t,30),this._sendCommand(null,e,`/commercial ${t}`,(s,o)=>{this.once("_promiseCommercial",r=>{r?o(r):s([e,~~t])})})},deletemessage(e,t){return e=y.channel(e),this._sendCommand(null,e,`/delete ${t}`,(s,o)=>{this.once("_promiseDeletemessage",r=>{r?o(r):s([e])})})},emoteonly(e){return e=y.channel(e),this._sendCommand(null,e,"/emoteonly",(t,s)=>{this.once("_promiseEmoteonly",o=>{o?s(o):t([e])})})},emoteonlyoff(e){return e=y.channel(e),this._sendCommand(null,e,"/emoteonlyoff",(t,s)=>{this.once("_promiseEmoteonlyoff",o=>{o?s(o):t([e])})})},followersonly:ge,followersmode:ge,followersonlyoff:be,followersmodeoff:be,host(e,t){return e=y.channel(e),t=y.username(t),this._sendCommand(2e3,e,`/host ${t}`,(s,o)=>{this.once("_promiseHost",(r,l)=>{r?o(r):s([e,t,~~l])})})},join(e){return e=y.channel(e),this._sendCommand(void 0,null,`JOIN ${e}`,(t,s)=>{const o="_promiseJoin";let r=!1;const l=(m,f)=>{e===y.channel(f)&&(this.removeListener(o,l),r=!0,m?s(m):t([e]))};this.on(o,l);const d=this._getPromiseDelay();y.promiseDelay(d).then(()=>{r||this.emit(o,"No response from Twitch.",e)})})},mod(e,t){return e=y.channel(e),t=y.username(t),this._sendCommand(null,e,`/mod ${t}`,(s,o)=>{this.once("_promiseMod",r=>{r?o(r):s([e,t])})})},mods(e){return e=y.channel(e),this._sendCommand(null,e,"/mods",(t,s)=>{this.once("_promiseMods",(o,r)=>{o?s(o):(r.forEach(l=>{this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(l)||this.moderators[e].push(l)}),t(r))})})},part:_e,leave:_e,ping(){return this._sendCommand(null,null,"PING",(e,t)=>{this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},y.get(this.opts.connection.timeout,9999)),this.once("_promisePing",s=>e([parseFloat(s)]))})},r9kbeta:ve,r9kmode:ve,r9kbetaoff:we,r9kmodeoff:we,raw(e){return this._sendCommand(null,null,e,(t,s)=>{t([e])})},say(e,t){return e=y.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?t.substr(1,3)==="me "?this.action(e,t.substr(4)):this._sendCommand(null,e,t,(s,o)=>{s([e,t])}):this._sendMessage(this._getPromiseDelay(),e,t,(s,o)=>{s([e,t])})},slow:ye,slowmode:ye,slowoff:xe,slowmodeoff:xe,subscribers(e){return e=y.channel(e),this._sendCommand(null,e,"/subscribers",(t,s)=>{this.once("_promiseSubscribers",o=>{o?s(o):t([e])})})},subscribersoff(e){return e=y.channel(e),this._sendCommand(null,e,"/subscribersoff",(t,s)=>{this.once("_promiseSubscribersoff",o=>{o?s(o):t([e])})})},timeout(e,t,s,o){return e=y.channel(e),t=y.username(t),s!==null&&!y.isInteger(s)&&(o=s,s=300),s=y.get(s,300),o=y.get(o,""),this._sendCommand(null,e,`/timeout ${t} ${s} ${o}`,(r,l)=>{this.once("_promiseTimeout",d=>{d?l(d):r([e,t,~~s,o])})})},unban(e,t){return e=y.channel(e),t=y.username(t),this._sendCommand(null,e,`/unban ${t}`,(s,o)=>{this.once("_promiseUnban",r=>{r?o(r):s([e,t])})})},unhost(e){return e=y.channel(e),this._sendCommand(2e3,e,"/unhost",(t,s)=>{this.once("_promiseUnhost",o=>{o?s(o):t([e])})})},unmod(e,t){return e=y.channel(e),t=y.username(t),this._sendCommand(null,e,`/unmod ${t}`,(s,o)=>{this.once("_promiseUnmod",r=>{r?o(r):s([e,t])})})},unvip(e,t){return e=y.channel(e),t=y.username(t),this._sendCommand(null,e,`/unvip ${t}`,(s,o)=>{this.once("_promiseUnvip",r=>{r?o(r):s([e,t])})})},vip(e,t){return e=y.channel(e),t=y.username(t),this._sendCommand(null,e,`/vip ${t}`,(s,o)=>{this.once("_promiseVip",r=>{r?o(r):s([e,t])})})},vips(e){return e=y.channel(e),this._sendCommand(null,e,"/vips",(t,s)=>{this.once("_promiseVips",(o,r)=>{o?s(o):t(r)})})},whisper(e,t){return e=y.username(e),e===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs",`/w ${e} ${t}`,(s,o)=>{this.once("_promiseWhisper",r=>{r&&o(r)})}).catch(s=>{if(s&&typeof s=="string"&&s.indexOf("No response from Twitch.")!==0)throw s;const o=y.channel(e),r=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);return this.emits(["whisper","message"],[[o,r,t,!0],[o,r,t,!0]]),[e,t]})}};function R(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var rt=R;R.EventEmitter=R;R.prototype._events=void 0;R.prototype._maxListeners=void 0;R.defaultMaxListeners=10;R.prototype.setMaxListeners=function(e){if(!at(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this};R.prototype.emit=function(e){var t,s,o,r,l,d;if(this._events||(this._events={}),e==="error"&&(!this._events.error||te(this._events.error)&&!this._events.error.length))throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');if(s=this._events[e],Pe(s))return!1;if(D(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),s.apply(this,r)}else if(te(s))for(r=Array.prototype.slice.call(arguments,1),d=s.slice(),o=d.length,l=0;l<o;l++)d[l].apply(this,r);return!0};R.prototype.addListener=function(e,t){var s;if(!D(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,D(t.listener)?t.listener:t),this._events[e]?te(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,te(this._events[e])&&!this._events[e].warned&&(Pe(this._maxListeners)?s=R.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),typeof console.trace=="function"&&console.trace())),this};R.prototype.on=R.prototype.addListener;R.prototype.once=function(e,t){if(!D(t))throw TypeError("listener must be a function");var s=!1;if(this._events.hasOwnProperty(e)&&e.charAt(0)==="_"){var o=1,r=e;for(var l in this._events)this._events.hasOwnProperty(l)&&l.startsWith(r)&&o++;e=e+o}function d(){e.charAt(0)==="_"&&!isNaN(e.substr(e.length-1))&&(e=e.substring(0,e.length-1)),this.removeListener(e,d),s||(s=!0,t.apply(this,arguments))}return d.listener=t,this.on(e,d),this};R.prototype.removeListener=function(e,t){var s,o,r,l;if(!D(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=this._events[e],r=s.length,o=-1,s===t||D(s.listener)&&s.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&e.charAt(0)==="_"){var d=e;for(var m in this._events)this._events.hasOwnProperty(m)&&m.startsWith(d)&&(isNaN(parseInt(m.substr(m.length-1)))||(this._events[e+parseInt(m.substr(m.length-1)-1)]=this._events[m],delete this._events[m]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(te(s)){for(l=r;l-- >0;)if(s[l]===t||s[l].listener&&s[l].listener===t){o=l;break}if(o<0)return this;s.length===1?(s.length=0,delete this._events[e]):s.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this};R.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events)t!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],D(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this};R.prototype.listeners=function(e){var t;return!this._events||!this._events[e]?t=[]:D(this._events[e])?t=[this._events[e]]:t=this._events[e].slice(),t};R.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(D(t))return 1;if(t)return t.length}return 0};R.listenerCount=function(e,t){return e.listenerCount(t)};function D(e){return typeof e=="function"}function at(e){return typeof e=="number"}function te(e){return typeof e=="object"&&e!==null}function Pe(e){return e===void 0}const lt=se;let Ue="info";const Ce={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function Q(e){return function(t){Ce[e]>=Ce[Ue]&&console.log(`[${lt.formatDate(new Date)}] ${e}: ${t}`)}}var ct={setLevel(e){Ue=e},trace:Q("trace"),debug:Q("debug"),info:Q("info"),warn:Q("warn"),error:Q("error"),fatal:Q("fatal")};const re=se,Z=/\S+/g;function ae(e,t,s=",",o="/",r){const l=e[t];if(l===void 0)return e;const d=typeof l=="string";if(e[t+"-raw"]=d?l:null,l===!0)return e[t]=null,e;if(e[t]={},d){const m=l.split(s);for(let f=0;f<m.length;f++){const x=m[f].split(o);let c=x[1];r!==void 0&&c&&(c=c.split(r)),e[t][x[0]]=c||null}}return e}var ut={badges:e=>ae(e,"badges"),badgeInfo:e=>ae(e,"badge-info"),emotes:e=>ae(e,"emotes","/",":",","),emoteRegex(e,t,s,o){Z.lastIndex=0;const r=new RegExp("(\\b|^|\\s)"+re.unescapeHtml(t)+"(\\b|$|\\s)");let l;for(;(l=Z.exec(e))!==null;)r.test(l[0])&&(o[s]=o[s]||[],o[s].push([l.index,Z.lastIndex-1]))},emoteString(e,t,s,o){Z.lastIndex=0;let r;for(;(r=Z.exec(e))!==null;)r[0]===re.unescapeHtml(t)&&(o[s]=o[s]||[],o[s].push([r.index,Z.lastIndex-1]))},transformEmotes(e){let t="";return Object.keys(e).forEach(s=>{t=`${t+s}:`,e[s].forEach(o=>t=`${t+o.join("-")},`),t=`${t.slice(0,-1)}/`}),t.slice(0,-1)},formTags(e){const t=[];for(const s in e){const o=re.escapeIRC(e[s]);t.push(`${s}=${o}`)}return`@${t.join(";")}`},msg(e){const t={raw:e,tags:{},prefix:null,command:null,params:[]};let s=0,o=0;if(e.charCodeAt(0)===64){if(o=e.indexOf(" "),o===-1)return null;const r=e.slice(1,o).split(";");for(let l=0;l<r.length;l++){const d=r[l],m=d.split("=");t.tags[m[0]]=d.substring(d.indexOf("=")+1)||!0}s=o+1}for(;e.charCodeAt(s)===32;)s++;if(e.charCodeAt(s)===58){if(o=e.indexOf(" ",s),o===-1)return null;for(t.prefix=e.slice(s+1,o),s=o+1;e.charCodeAt(s)===32;)s++}if(o=e.indexOf(" ",s),o===-1)return e.length>s?(t.command=e.slice(s),t):null;for(t.command=e.slice(s,o),s=o+1;e.charCodeAt(s)===32;)s++;for(;s<e.length;){if(o=e.indexOf(" ",s),e.charCodeAt(s)===58){t.params.push(e.slice(s+1));break}if(o!==-1){for(t.params.push(e.slice(s,o)),s=o+1;e.charCodeAt(s)===32;)s++;continue}if(o===-1){t.params.push(e.slice(s));break}}return t}};class dt{constructor(t){this.queue=[],this.index=0,this.defaultDelay=t===void 0?3e3:t}add(t,s){this.queue.push({fn:t,delay:s})}next(){const t=this.index++,s=this.queue[t];if(!s)return;const o=this.queue[this.index];if(s.fn(),o){const r=o.delay===void 0?this.defaultDelay:o.delay;setTimeout(()=>this.next(),r)}}}var ht=dt;(function(e){const t=typeof he<"u"?he:typeof window<"u"?window:{},s=t.WebSocket||le,o=t.fetch||le,r=it,l=nt,d=rt.EventEmitter,m=ct,f=ut,x=ht,c=se;let k=!1;const b=function v(n){if(!(this instanceof v))return new v(n);this.opts=c.get(n,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=c.get(this.opts.options.clientId,null),this._globalDefaultChannel=c.channel(c.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=c.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=c.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=c.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=c.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=c.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=c.get(this.opts.connection.reconnect,!0),this.reconnectDecay=c.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=c.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=c.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;let i="error";this.opts.options.debug&&(i="info"),this.log=this.opts.logger||m;try{m.setLevel(i)}catch{}this.opts.channels.forEach((a,w,p)=>p[w]=c.channel(a)),d.call(this),this.setMaxListeners(0)};c.inherits(b,d);for(const v in l)b.prototype[v]=l[v];b.prototype.emits=function(n,i){for(let a=0;a<n.length;a++){const w=a<i.length?i[a]:i[i.length-1];this.emit.apply(this,[n[a]].concat(w))}},b.prototype.api=function(...v){k||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),k=!0),r(...v)},b.prototype.handleMessage=function(n){if(!n)return;this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(n)),n);const i=c.channel(c.get(n.params[0],null));let a=c.get(n.params[1],null);const w=c.get(n.tags["msg-id"],null),p=n.tags=f.badges(f.badgeInfo(f.emotes(n.tags)));for(const h in p){if(h==="emote-sets"||h==="ban-duration"||h==="bits")continue;let u=p[h];typeof u=="boolean"?u=null:u==="1"?u=!0:u==="0"?u=!1:typeof u=="string"&&(u=c.unescapeIRC(u)),p[h]=u}if(n.prefix===null)switch(n.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":{const h=new Date;this.currentLatency=(h.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break}default:this.log.warn(`Could not parse message with no prefix:
${JSON.stringify(n,null,4)}`);break}else if(n.prefix==="tmi.twitch.tv")switch(n.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=n.params[0];break;case"376":{this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(()=>{this._isConnected()&&this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer))},c.get(this.opts.connection.timeout,9999))},6e4);let h=c.get(this.opts.options.joinInterval,2e3);h<300&&(h=300);const u=new x(h),T=[...new Set([...this.opts.channels,...this.channels])];this.channels=[];for(let N=0;N<T.length;N++){const S=T[N];u.add(()=>{this._isConnected()&&this.join(S).catch(E=>this.log.error(E))})}u.next();break}case"NOTICE":{const h=[null],u=[i,w,a],T=[w],N=[i,!0],S=[i,!1],E=[u,h],C=[u,T],_=`[${i}] ${a}`;switch(w){case"subs_on":this.log.info(`[${i}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[N,N,h]);break;case"subs_off":this.log.info(`[${i}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[S,S,h]);break;case"emote_only_on":this.log.info(`[${i}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[N,h]);break;case"emote_only_off":this.log.info(`[${i}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[S,h]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info(`[${i}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[N,N,h]);break;case"r9k_off":this.log.info(`[${i}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[S,S,h]);break;case"room_mods":{const M=a.split(": "),j=(M.length>1?M[1]:"").toLowerCase().split(", ").filter(O=>O);this.emits(["_promiseMods","mods"],[[null,j],[i,j]]);break}case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[i,[]]]);break;case"vips_success":{a.endsWith(".")&&(a=a.slice(0,-1));const M=a.split(": "),j=(M.length>1?M[1]:"").toLowerCase().split(", ").filter(O=>O);this.emits(["_promiseVips","vips"],[[null,j],[i,j]]);break}case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[i,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(_),this.emits(["notice","_promiseBan"],C);break;case"ban_success":this.log.info(_),this.emits(["notice","_promiseBan"],E);break;case"usage_clear":this.log.info(_),this.emits(["notice","_promiseClear"],C);break;case"usage_mods":this.log.info(_),this.emits(["notice","_promiseMods"],[u,[w,[]]]);break;case"mod_success":this.log.info(_),this.emits(["notice","_promiseMod"],E);break;case"usage_vips":this.log.info(_),this.emits(["notice","_promiseVips"],[u,[w,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(_),this.emits(["notice","_promiseVip"],[u,[w,[]]]);break;case"vip_success":this.log.info(_),this.emits(["notice","_promiseVip"],E);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(_),this.emits(["notice","_promiseMod"],C);break;case"unmod_success":this.log.info(_),this.emits(["notice","_promiseUnmod"],E);break;case"unvip_success":this.log.info(_),this.emits(["notice","_promiseUnvip"],E);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(_),this.emits(["notice","_promiseUnmod"],C);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(_),this.emits(["notice","_promiseUnvip"],C);break;case"color_changed":this.log.info(_),this.emits(["notice","_promiseColor"],E);break;case"usage_color":case"turbo_only_color":this.log.info(_),this.emits(["notice","_promiseColor"],C);break;case"commercial_success":this.log.info(_),this.emits(["notice","_promiseCommercial"],E);break;case"usage_commercial":case"bad_commercial_error":this.log.info(_),this.emits(["notice","_promiseCommercial"],C);break;case"hosts_remaining":{this.log.info(_);const M=isNaN(a[0])?0:parseInt(a[0]);this.emits(["notice","_promiseHost"],[u,[null,~~M]]);break}case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(_),this.emits(["notice","_promiseHost"],[u,[w,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(_),this.emits(["notice","_promiseR9kbeta"],C);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(_),this.emits(["notice","_promiseR9kbetaoff"],C);break;case"timeout_success":this.log.info(_),this.emits(["notice","_promiseTimeout"],E);break;case"delete_message_success":this.log.info(`[${i} ${a}]`),this.emits(["notice","_promiseDeletemessage"],E);break;case"already_subs_off":case"usage_subs_off":this.log.info(_),this.emits(["notice","_promiseSubscribersoff"],C);break;case"already_subs_on":case"usage_subs_on":this.log.info(_),this.emits(["notice","_promiseSubscribers"],C);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(_),this.emits(["notice","_promiseEmoteonlyoff"],C);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(_),this.emits(["notice","_promiseEmoteonly"],C);break;case"usage_slow_on":this.log.info(_),this.emits(["notice","_promiseSlow"],C);break;case"usage_slow_off":this.log.info(_),this.emits(["notice","_promiseSlowoff"],C);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(_),this.emits(["notice","_promiseTimeout"],C);break;case"untimeout_success":case"unban_success":this.log.info(_),this.emits(["notice","_promiseUnban"],E);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(_),this.emits(["notice","_promiseUnban"],C);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(_),this.emits(["notice","_promiseDeletemessage"],C);break;case"usage_unhost":case"not_hosting":this.log.info(_),this.emits(["notice","_promiseUnhost"],C);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(_),this.emits(["notice","_promiseWhisper"],C);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(_),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[u,[w,i]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(_),this.emit("automod",i,w,a);break;case"unrecognized_cmd":this.log.info(_),this.emit("notice",i,w,a);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(_),this.emit("notice",i,w,a);break;case"host_on":case"host_off":break;default:a.includes("Login unsuccessful")||a.includes("Login authentication failed")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=a,this.log.error(this.reason),this.ws.close()):a.includes("Error logging in")||a.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=a,this.log.error(this.reason),this.ws.close()):a.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
${JSON.stringify(n,null,4)}`),this.emit("notice",i,w,a));break}break}case"USERNOTICE":{const h=p["display-name"]||p.login,u=p["msg-param-sub-plan"]||"",T=c.unescapeIRC(c.get(p["msg-param-sub-plan-name"],""))||null,S={prime:u.includes("Prime"),plan:u,planName:T},E=~~(p["msg-param-streak-months"]||0),C=p["msg-param-recipient-display-name"]||p["msg-param-recipient-user-name"],_=~~p["msg-param-mass-gift-count"];switch(p["message-type"]=w,w){case"resub":this.emits(["resub","subanniversary"],[[i,h,E,a,p,S]]);break;case"sub":this.emits(["subscription","sub"],[[i,h,S,a,p]]);break;case"subgift":this.emit("subgift",i,h,E,C,S,p);break;case"anonsubgift":this.emit("anonsubgift",i,E,C,S,p);break;case"submysterygift":this.emit("submysterygift",i,h,_,S,p);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",i,_,S,p);break;case"primepaidupgrade":this.emit("primepaidupgrade",i,h,S,p);break;case"giftpaidupgrade":{const M=p["msg-param-sender-name"]||p["msg-param-sender-login"];this.emit("giftpaidupgrade",i,h,M,p);break}case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",i,h,p);break;case"raid":{const M=p["msg-param-displayName"]||p["msg-param-login"],j=+p["msg-param-viewerCount"];this.emit("raided",i,M,j,p);break}case"ritual":{const M=p["msg-param-ritual-name"];switch(M){case"new_chatter":this.emit("newchatter",i,h,p,a);break;default:this.emit("ritual",M,i,h,p,a);break}break}default:this.emit("usernotice",w,i,p,a);break}break}case"HOSTTARGET":{const h=a.split(" "),u=~~h[1]||0;h[0]==="-"?(this.log.info(`[${i}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[i,u],[null]])):(this.log.info(`[${i}] Now hosting ${h[0]} for ${u} viewer(s).`),this.emit("hosting",i,h[0],u));break}case"CLEARCHAT":if(n.params.length>1){const h=c.get(n.tags["ban-duration"],null);h===null?(this.log.info(`[${i}] ${a} has been banned.`),this.emit("ban",i,a,null,n.tags)):(this.log.info(`[${i}] ${a} has been timed out for ${h} seconds.`),this.emit("timeout",i,a,null,~~h,n.tags))}else this.log.info(`[${i}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[i],[null]]);break;case"CLEARMSG":if(n.params.length>1){const h=a,u=p.login;p["message-type"]="messagedeleted",this.log.info(`[${i}] ${u}'s message has been deleted.`),this.emit("messagedeleted",i,u,h,p)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect().catch(h=>this.log.error(h)),setTimeout(()=>this.connect().catch(h=>this.log.error(h)),this.reconnectTimer);break;case"USERSTATE":n.tags.username=this.username,n.tags["user-type"]==="mod"&&(this.moderators[i]||(this.moderators[i]=[]),this.moderators[i].includes(this.username)||this.moderators[i].push(this.username)),!c.isJustinfan(this.getUsername())&&!this.userstate[i]&&(this.userstate[i]=p,this.lastJoined=i,this.channels.push(i),this.log.info(`Joined ${i}`),this.emit("join",i,c.username(this.getUsername()),!0)),n.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(n.tags["emote-sets"]),this.userstate[i]=p;break;case"GLOBALUSERSTATE":this.globaluserstate=p,this.emit("globaluserstate",p),typeof n.tags["emote-sets"]<"u"&&this._updateEmoteset(n.tags["emote-sets"]);break;case"ROOMSTATE":if(c.channel(this.lastJoined)===i&&this.emit("_promiseJoin",null,i),n.tags.channel=i,this.emit("roomstate",i,n.tags),!c.hasOwn(n.tags,"subs-only")){if(c.hasOwn(n.tags,"slow"))if(typeof n.tags.slow=="boolean"&&!n.tags.slow){const h=[i,!1,0];this.log.info(`[${i}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[h,h,[null]])}else{const h=~~n.tags.slow,u=[i,!0,h];this.log.info(`[${i}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[u,u,[null]])}if(c.hasOwn(n.tags,"followers-only"))if(n.tags["followers-only"]==="-1"){const h=[i,!1,0];this.log.info(`[${i}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[h,h,[null]])}else{const h=~~n.tags["followers-only"],u=[i,!0,h];this.log.info(`[${i}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[u,u,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
${JSON.stringify(n,null,4)}`);break}else if(n.prefix==="jtv")switch(n.command){case"MODE":a==="+o"?(this.moderators[i]||(this.moderators[i]=[]),this.moderators[i].includes(n.params[2])||this.moderators[i].push(n.params[2]),this.emit("mod",i,n.params[2])):a==="-o"&&(this.moderators[i]||(this.moderators[i]=[]),this.moderators[i].filter(h=>h!==n.params[2]),this.emit("unmod",i,n.params[2]));break;default:this.log.warn(`Could not parse message from jtv:
${JSON.stringify(n,null,4)}`);break}else switch(n.command){case"353":this.emit("names",n.params[2],n.params[3].split(" "));break;case"366":break;case"JOIN":{const h=n.prefix.split("!")[0];c.isJustinfan(this.getUsername())&&this.username===h&&(this.lastJoined=i,this.channels.push(i),this.log.info(`Joined ${i}`),this.emit("join",i,h,!0)),this.username!==h&&this.emit("join",i,h,!1);break}case"PART":{let h=!1;const u=n.prefix.split("!")[0];if(this.username===u){h=!0,this.userstate[i]&&delete this.userstate[i];let T=this.channels.indexOf(i);T!==-1&&this.channels.splice(T,1),T=this.opts.channels.indexOf(i),T!==-1&&this.opts.channels.splice(T,1),this.log.info(`Left ${i}`),this.emit("_promisePart",null)}this.emit("part",i,u,h);break}case"WHISPER":{const h=n.prefix.split("!")[0];this.log.info(`[WHISPER] <${h}>: ${a}`),c.hasOwn(n.tags,"username")||(n.tags.username=h),n.tags["message-type"]="whisper";const u=c.channel(n.tags.username);this.emits(["whisper","message"],[[u,n.tags,a,!1]]);break}case"PRIVMSG":if(n.tags.username=n.prefix.split("!")[0],n.tags.username==="jtv"){const h=c.username(a.split(" ")[0]),u=a.includes("auto");if(a.includes("hosting you for")){const T=c.extractNumber(a);this.emit("hosted",i,h,T,u)}else a.includes("hosting you")&&this.emit("hosted",i,h,0,u)}else{const h=c.get(this.opts.options.messagesLogLevel,"info"),u=c.actionMessage(a);if(n.tags["message-type"]=u?"action":"chat",a=u?u[1]:a,c.hasOwn(n.tags,"bits"))this.emit("cheer",i,n.tags,a);else{if(c.hasOwn(n.tags,"msg-id")){if(n.tags["msg-id"]==="highlighted-message"){const T=n.tags["msg-id"];this.emit("redeem",i,n.tags.username,T,n.tags,a)}else if(n.tags["msg-id"]==="skip-subs-mode-message"){const T=n.tags["msg-id"];this.emit("redeem",i,n.tags.username,T,n.tags,a)}}else if(c.hasOwn(n.tags,"custom-reward-id")){const T=n.tags["custom-reward-id"];this.emit("redeem",i,n.tags.username,T,n.tags,a)}u?(this.log[h](`[${i}] *<${n.tags.username}>: ${a}`),this.emits(["action","message"],[[i,n.tags,a,!1]])):(this.log[h](`[${i}] <${n.tags.username}>: ${a}`),this.emits(["chat","message"],[[i,n.tags,a,!1]]))}}break;default:this.log.warn(`Could not parse message:
${JSON.stringify(n,null,4)}`);break}},b.prototype.connect=function(){return new Promise((n,i)=>{this.server=c.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=c.get(this.opts.connection.port,80),this.secure&&(this.port=443),this.port===443&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",a=>{a?i(a):n([this.server,~~this.port])})})},b.prototype._openConnection=function(){const n=`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,i={};"agent"in this.opts.connection&&(i.agent=this.opts.connection.agent),this.ws=new s(n,"irc",i),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},b.prototype._onOpen=function(){this._isConnected()&&(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=c.get(this.opts.identity.username,c.justinfan()),this._getToken().then(n=>{const i=c.password(n);this.log.info("Sending authentication to server.."),this.emit("logon");let a="twitch.tv/tags twitch.tv/commands";this._skipMembership||(a+=" twitch.tv/membership"),this.ws.send("CAP REQ :"+a),i?this.ws.send(`PASS ${i}`):c.isJustinfan(this.username)&&this.ws.send("PASS SCHMOOPIIE"),this.ws.send(`NICK ${this.username}`)}).catch(n=>{this.emits(["_promiseConnect","disconnected"],[[n],["Could not get a token."]])}))},b.prototype._getToken=function(){const n=this.opts.identity.password;let i;return typeof n=="function"?(i=n(),i instanceof Promise?i:Promise.resolve(i)):Promise.resolve(n)},b.prototype._onMessage=function(n){n.data.trim().split(`\r
`).forEach(a=>{const w=f.msg(a);w&&this.handleMessage(w)})},b.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(n=>this.log.error(n))},this.reconnectTimer)),this.ws=null},b.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(n=>this.log.error(n))},this.reconnectTimer))),this.ws=null},b.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},b.prototype._sendCommand=function(n,i,a,w){return new Promise((p,h)=>{if(this._isConnected())(n===null||typeof n=="number")&&(n===null&&(n=this._getPromiseDelay()),c.promiseDelay(n).then(()=>h("No response from Twitch.")));else return h("Not connected to server.");if(i!==null){const u=c.channel(i);this.log.info(`[${u}] Executing command: ${a}`),this.ws.send(`PRIVMSG ${u} :${a}`)}else this.log.info(`Executing command: ${a}`),this.ws.send(a);typeof w=="function"?w(p,h):p()})},b.prototype._sendMessage=function(n,i,a,w){return new Promise((p,h)=>{if(this._isConnected()){if(c.isJustinfan(this.getUsername()))return h("Cannot send anonymous messages.")}else return h("Not connected to server.");const u=c.channel(i);if(this.userstate[u]||(this.userstate[u]={}),a.length>=500){const C=c.splitLine(a,500);a=C[0],setTimeout(()=>{this._sendMessage(n,i,C[1],()=>{})},350)}this.ws.send(`PRIVMSG ${u} :${a}`);const T={};Object.keys(this.emotesets).forEach(C=>this.emotesets[C].forEach(_=>(c.isRegex(_.code)?f.emoteRegex:f.emoteString)(a,_.code,_.id,T)));const N=Object.assign(this.userstate[u],f.emotes({emotes:f.transformEmotes(T)||null})),S=c.get(this.opts.options.messagesLogLevel,"info"),E=c.actionMessage(a);E?(N["message-type"]="action",this.log[S](`[${u}] *<${this.getUsername()}>: ${E[1]}`),this.emits(["action","message"],[[u,N,E[1],!0]])):(N["message-type"]="chat",this.log[S](`[${u}] <${this.getUsername()}>: ${a}`),this.emits(["chat","message"],[[u,N,a,!0]])),typeof w=="function"?w(p,h):p()})},b.prototype._updateEmoteset=function(n){let i=n!==void 0;if(i&&(n===this.emotes?i=!1:this.emotes=n),this._skipUpdatingEmotesets){i&&this.emit("emotesets",n,{});return}const a=()=>{this._updateEmotesetsTimerDelay>0&&(clearTimeout(this._updateEmotesetsTimer),this._updateEmotesetsTimer=setTimeout(()=>this._updateEmoteset(n),this._updateEmotesetsTimerDelay))};this._getToken().then(w=>{const p=`https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=${n}`,h={};return"fetchAgent"in this.opts.connection&&(h.agent=this.opts.connection.fetchAgent),o(p,{...h,headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${c.token(w)}`,"Client-ID":this.clientId}})}).then(w=>w.json()).then(w=>{this.emotesets=w.emoticon_sets||{},this.emit("emotesets",n,this.emotesets),a()}).catch(()=>a())},b.prototype.getUsername=function(){return this.username},b.prototype.getOptions=function(){return this.opts},b.prototype.getChannels=function(){return this.channels},b.prototype.isMod=function(n,i){const a=c.channel(n);return this.moderators[a]||(this.moderators[a]=[]),this.moderators[a].includes(c.username(i))},b.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},b.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},b.prototype.disconnect=function(){return new Promise((n,i)=>{this.ws!==null&&this.ws.readyState!==3?(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",()=>n([this.server,~~this.port]))):(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),i("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},b.prototype.off=b.prototype.removeListener,e.exports&&(e.exports=b),typeof window<"u"&&(window.tmi={client:b,Client:b})})(je);var mt=je.exports;const ke=mt;var ft={client:ke,Client:ke};const pt=He(ft);function Te(e,t,s){return Math.min(Math.max(t,e),s)}function Ee(e,t,s){return(t-e)*s+e}function gt(){for(var e=0,t,s,o="";e<arguments.length;)(t=arguments[e++])&&(s=ze(t))&&(o&&(o+=" "),o+=s);return o}function ze(e){if(typeof e=="string")return e;for(var t,s="",o=0;o<e.length;o++)e[o]&&(t=ze(e[o]))&&(s&&(s+=" "),s+=t);return s}var ue="-";function bt(e){var t=vt(e),s=e.conflictingClassGroups,o=e.conflictingClassGroupModifiers,r=o===void 0?{}:o;function l(m){var f=m.split(ue);return f[0]===""&&f.length!==1&&f.shift(),Ge(f,t)||_t(m)}function d(m,f){var x=s[m]||[];return f&&r[m]?[].concat(x,r[m]):x}return{getClassGroupId:l,getConflictingClassGroupIds:d}}function Ge(e,t){var d;if(e.length===0)return t.classGroupId;var s=e[0],o=t.nextPart.get(s),r=o?Ge(e.slice(1),o):void 0;if(r)return r;if(t.validators.length!==0){var l=e.join(ue);return(d=t.validators.find(function(m){var f=m.validator;return f(l)}))==null?void 0:d.classGroupId}}var Se=/^\[(.+)\]$/;function _t(e){if(Se.test(e)){var t=Se.exec(e)[1],s=t==null?void 0:t.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}}function vt(e){var t=e.theme,s=e.prefix,o={nextPart:new Map,validators:[]},r=yt(Object.entries(e.classGroups),s);return r.forEach(function(l){var d=l[0],m=l[1];ce(m,o,d,t)}),o}function ce(e,t,s,o){e.forEach(function(r){if(typeof r=="string"){var l=r===""?t:Ie(t,r);l.classGroupId=s;return}if(typeof r=="function"){if(wt(r)){ce(r(o),t,s,o);return}t.validators.push({validator:r,classGroupId:s});return}Object.entries(r).forEach(function(d){var m=d[0],f=d[1];ce(f,Ie(t,m),s,o)})})}function Ie(e,t){var s=e;return t.split(ue).forEach(function(o){s.nextPart.has(o)||s.nextPart.set(o,{nextPart:new Map,validators:[]}),s=s.nextPart.get(o)}),s}function wt(e){return e.isThemeGetter}function yt(e,t){return t?e.map(function(s){var o=s[0],r=s[1],l=r.map(function(d){return typeof d=="string"?t+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(function(m){var f=m[0],x=m[1];return[t+f,x]})):d});return[o,l]}):e}function xt(e){if(e<1)return{get:function(){},set:function(){}};var t=0,s=new Map,o=new Map;function r(l,d){s.set(l,d),t++,t>e&&(t=0,o=s,s=new Map)}return{get:function(d){var m=s.get(d);if(m!==void 0)return m;if((m=o.get(d))!==void 0)return r(d,m),m},set:function(d,m){s.has(d)?s.set(d,m):r(d,m)}}}var De="!";function Ct(e){var t=e.separator||":",s=t.length===1,o=t[0],r=t.length;return function(d){for(var m=[],f=0,x=0,c,k=0;k<d.length;k++){var b=d[k];if(f===0){if(b===o&&(s||d.slice(k,k+r)===t)){m.push(d.slice(x,k)),x=k+r;continue}if(b==="/"){c=k;continue}}b==="["?f++:b==="]"&&f--}var v=m.length===0?d:d.substring(x),n=v.startsWith(De),i=n?v.substring(1):v,a=c&&c>x?c-x:void 0;return{modifiers:m,hasImportantModifier:n,baseClassName:i,maybePostfixModifierPosition:a}}}function kt(e){if(e.length<=1)return e;var t=[],s=[];return e.forEach(function(o){var r=o[0]==="[";r?(t.push.apply(t,s.sort().concat([o])),s=[]):s.push(o)}),t.push.apply(t,s.sort()),t}function Tt(e){return{cache:xt(e.cacheSize),splitModifiers:Ct(e),...bt(e)}}var Et=/\s+/;function St(e,t){var s=t.splitModifiers,o=t.getClassGroupId,r=t.getConflictingClassGroupIds,l=new Set;return e.trim().split(Et).map(function(d){var m=s(d),f=m.modifiers,x=m.hasImportantModifier,c=m.baseClassName,k=m.maybePostfixModifierPosition,b=o(k?c.substring(0,k):c),v=!!k;if(!b){if(!k)return{isTailwindClass:!1,originalClassName:d};if(b=o(c),!b)return{isTailwindClass:!1,originalClassName:d};v=!1}var n=kt(f).join(":"),i=x?n+De:n;return{isTailwindClass:!0,modifierId:i,classGroupId:b,originalClassName:d,hasPostfixModifier:v}}).reverse().filter(function(d){if(!d.isTailwindClass)return!0;var m=d.modifierId,f=d.classGroupId,x=d.hasPostfixModifier,c=m+f;return l.has(c)?!1:(l.add(c),r(f,x).forEach(function(k){return l.add(m+k)}),!0)}).reverse().map(function(d){return d.originalClassName}).join(" ")}function It(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var o,r,l,d=m;function m(x){var c=t[0],k=t.slice(1),b=k.reduce(function(v,n){return n(v)},c());return o=Tt(b),r=o.cache.get,l=o.cache.set,d=f,f(x)}function f(x){var c=r(x);if(c)return c;var k=St(x,o);return l(x,k),k}return function(){return d(gt.apply(null,arguments))}}function $(e){var t=function(o){return o[e]||[]};return t.isThemeGetter=!0,t}var Be=/^\[(?:([a-z-]+):)?(.+)\]$/i,Mt=/^\d+\/\d+$/,Nt=new Set(["px","full","screen"]),$t=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Lt=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|^0$/,At=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function U(e){return H(e)||Nt.has(e)||Mt.test(e)||F(e)}function F(e){return J(e,"length",zt)}function Rt(e){return J(e,"size",Fe)}function jt(e){return J(e,"position",Fe)}function Ot(e){return J(e,"url",Gt)}function ne(e){return J(e,"number",H)}function H(e){return!Number.isNaN(Number(e))}function Pt(e){return e.endsWith("%")&&H(e.slice(0,-1))}function K(e){return Me(e)||J(e,"number",Me)}function L(e){return Be.test(e)}function ee(){return!0}function B(e){return $t.test(e)}function Ut(e){return J(e,"",Dt)}function J(e,t,s){var o=Be.exec(e);return o?o[1]?o[1]===t:s(o[2]):!1}function zt(e){return Lt.test(e)}function Fe(){return!1}function Gt(e){return e.startsWith("url(")}function Me(e){return Number.isInteger(Number(e))}function Dt(e){return At.test(e)}function Bt(){var e=$("colors"),t=$("spacing"),s=$("blur"),o=$("brightness"),r=$("borderColor"),l=$("borderRadius"),d=$("borderSpacing"),m=$("borderWidth"),f=$("contrast"),x=$("grayscale"),c=$("hueRotate"),k=$("invert"),b=$("gap"),v=$("gradientColorStops"),n=$("gradientColorStopPositions"),i=$("inset"),a=$("margin"),w=$("opacity"),p=$("padding"),h=$("saturate"),u=$("scale"),T=$("sepia"),N=$("skew"),S=$("space"),E=$("translate"),C=function(){return["auto","contain","none"]},_=function(){return["auto","hidden","clip","visible","scroll"]},M=function(){return["auto",t]},j=function(){return["",U]},O=function(){return["auto",H,L]},q=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},I=function(){return["solid","dashed","dotted","double","none"]},z=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},W=function(){return["start","end","center","between","around","evenly","stretch"]},X=function(){return["","0",L]},de=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},Y=function(){return[H,ne]},oe=function(){return[H,L]};return{cacheSize:500,theme:{colors:[ee],spacing:[U],blur:["none","",B,F],brightness:Y(),borderColor:[e],borderRadius:["none","","full",B,F],borderSpacing:[t],borderWidth:j(),contrast:Y(),grayscale:X(),hueRotate:oe(),invert:X(),gap:[t],gradientColorStops:[e],gradientColorStopPositions:[Pt,F],inset:M(),margin:M(),opacity:Y(),padding:[t],saturate:Y(),scale:Y(),sepia:X(),skew:oe(),space:[t],translate:[t]},classGroups:{aspect:[{aspect:["auto","square","video",L]}],container:["container"],columns:[{columns:[B]}],"break-after":[{"break-after":de()}],"break-before":[{"break-before":de()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(q(),[L])}],overflow:[{overflow:_()}],"overflow-x":[{"overflow-x":_()}],"overflow-y":[{"overflow-y":_()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[i]}],"inset-x":[{"inset-x":[i]}],"inset-y":[{"inset-y":[i]}],start:[{start:[i]}],end:[{end:[i]}],top:[{top:[i]}],right:[{right:[i]}],bottom:[{bottom:[i]}],left:[{left:[i]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",K]}],basis:[{basis:M()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",L]}],grow:[{grow:X()}],shrink:[{shrink:X()}],order:[{order:["first","last","none",K]}],"grid-cols":[{"grid-cols":[ee]}],"col-start-end":[{col:["auto",{span:[K]},L]}],"col-start":[{"col-start":O()}],"col-end":[{"col-end":O()}],"grid-rows":[{"grid-rows":[ee]}],"row-start-end":[{row:["auto",{span:[K]},L]}],"row-start":[{"row-start":O()}],"row-end":[{"row-end":O()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",L]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",L]}],gap:[{gap:[b]}],"gap-x":[{"gap-x":[b]}],"gap-y":[{"gap-y":[b]}],"justify-content":[{justify:["normal"].concat(W())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(W(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(W(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[p]}],px:[{px:[p]}],py:[{py:[p]}],ps:[{ps:[p]}],pe:[{pe:[p]}],pt:[{pt:[p]}],pr:[{pr:[p]}],pb:[{pb:[p]}],pl:[{pl:[p]}],m:[{m:[a]}],mx:[{mx:[a]}],my:[{my:[a]}],ms:[{ms:[a]}],me:[{me:[a]}],mt:[{mt:[a]}],mr:[{mr:[a]}],mb:[{mb:[a]}],ml:[{ml:[a]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",t]}],"min-w":[{"min-w":["min","max","fit",U]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[B]},B,F]}],h:[{h:[t,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",U]}],"max-h":[{"max-h":[t,"min","max","fit"]}],"font-size":[{text:["base",B,F]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ne]}],"font-family":[{font:[ee]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",F]}],"line-clamp":[{"line-clamp":["none",H,ne]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",U]}],"list-image":[{"list-image":["none",L]}],"list-style-type":[{list:["none","disc","decimal",L]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(I(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",U]}],"underline-offset":[{"underline-offset":["auto",U]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:[t]}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",F]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",L]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(q(),[jt])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Rt]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Ot]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[n]}],"gradient-via-pos":[{via:[n]}],"gradient-to-pos":[{to:[n]}],"gradient-from":[{from:[v]}],"gradient-via":[{via:[v]}],"gradient-to":[{to:[v]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[m]}],"border-w-x":[{"border-x":[m]}],"border-w-y":[{"border-y":[m]}],"border-w-s":[{"border-s":[m]}],"border-w-e":[{"border-e":[m]}],"border-w-t":[{"border-t":[m]}],"border-w-r":[{"border-r":[m]}],"border-w-b":[{"border-b":[m]}],"border-w-l":[{"border-l":[m]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[].concat(I(),["hidden"])}],"divide-x":[{"divide-x":[m]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[m]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:I()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:[""].concat(I())}],"outline-offset":[{"outline-offset":[U]}],"outline-w":[{outline:[U]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:j()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[U]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",B,Ut]}],"shadow-color":[{shadow:[ee]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":z()}],"bg-blend":[{"bg-blend":z()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[o]}],contrast:[{contrast:[f]}],"drop-shadow":[{"drop-shadow":["","none",B,L]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[k]}],saturate:[{saturate:[h]}],sepia:[{sepia:[T]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[o]}],"backdrop-contrast":[{"backdrop-contrast":[f]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[k]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[h]}],"backdrop-sepia":[{"backdrop-sepia":[T]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[d]}],"border-spacing-x":[{"border-spacing-x":[d]}],"border-spacing-y":[{"border-spacing-y":[d]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",L]}],duration:[{duration:oe()}],ease:[{ease:["linear","in","out","in-out",L]}],delay:[{delay:oe()}],animate:[{animate:["none","spin","ping","pulse","bounce",L]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[u]}],"scale-x":[{"scale-x":[u]}],"scale-y":[{"scale-y":[u]}],rotate:[{rotate:[K,L]}],"translate-x":[{"translate-x":[E]}],"translate-y":[{"translate-y":[E]}],"skew-x":[{"skew-x":[N]}],"skew-y":[{"skew-y":[N]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",L]}],accent:[{accent:["auto",e]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",L]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":[t]}],"scroll-mx":[{"scroll-mx":[t]}],"scroll-my":[{"scroll-my":[t]}],"scroll-ms":[{"scroll-ms":[t]}],"scroll-me":[{"scroll-me":[t]}],"scroll-mt":[{"scroll-mt":[t]}],"scroll-mr":[{"scroll-mr":[t]}],"scroll-mb":[{"scroll-mb":[t]}],"scroll-ml":[{"scroll-ml":[t]}],"scroll-p":[{"scroll-p":[t]}],"scroll-px":[{"scroll-px":[t]}],"scroll-py":[{"scroll-py":[t]}],"scroll-ps":[{"scroll-ps":[t]}],"scroll-pe":[{"scroll-pe":[t]}],"scroll-pt":[{"scroll-pt":[t]}],"scroll-pr":[{"scroll-pr":[t]}],"scroll-pb":[{"scroll-pb":[t]}],"scroll-pl":[{"scroll-pl":[t]}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",L]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[U,ne]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var We=It(Bt);const Ft=e=>g.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 340.274 340.274",fill:"currentColor",...e,children:g.jsx("path",{d:`M293.629,127.806l-5.795-13.739c19.846-44.856,18.53-46.189,14.676-50.08l-25.353-24.77l-2.516-2.12h-2.937
				c-1.549,0-6.173,0-44.712,17.48l-14.184-5.719c-18.332-45.444-20.212-45.444-25.58-45.444h-35.765
				c-5.362,0-7.446-0.006-24.448,45.606l-14.123,5.734C86.848,43.757,71.574,38.19,67.452,38.19l-3.381,0.105L36.801,65.032
				c-4.138,3.891-5.582,5.263,15.402,49.425l-5.774,13.691C0,146.097,0,147.838,0,153.33v35.068c0,5.501,0,7.44,46.585,24.127
				l5.773,13.667c-19.843,44.832-18.51,46.178-14.655,50.032l25.353,24.8l2.522,2.168h2.951c1.525,0,6.092,0,44.685-17.516
				l14.159,5.758c18.335,45.438,20.218,45.427,25.598,45.427h35.771c5.47,0,7.41,0,24.463-45.589l14.195-5.74
				c26.014,11,41.253,16.585,45.349,16.585l3.404-0.096l27.479-26.901c3.909-3.945,5.278-5.309-15.589-49.288l5.734-13.702
				c46.496-17.967,46.496-19.853,46.496-25.221v-35.029C340.268,146.361,340.268,144.434,293.629,127.806z M170.128,228.474
				c-32.798,0-59.504-26.187-59.504-58.364c0-32.153,26.707-58.315,59.504-58.315c32.78,0,59.43,26.168,59.43,58.315
				C229.552,202.287,202.902,228.474,170.128,228.474z`})}),Wt=Ft,Vt=e=>g.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",...e,children:g.jsx("path",{d:"M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM15.36 14.3C15.65 14.59 15.65 15.07 15.36 15.36C15.21 15.51 15.02 15.58 14.83 15.58C14.64 15.58 14.45 15.51 14.3 15.36L12 13.06L9.7 15.36C9.55 15.51 9.36 15.58 9.17 15.58C8.98 15.58 8.79 15.51 8.64 15.36C8.35 15.07 8.35 14.59 8.64 14.3L10.94 12L8.64 9.7C8.35 9.41 8.35 8.93 8.64 8.64C8.93 8.35 9.41 8.35 9.7 8.64L12 10.94L14.3 8.64C14.59 8.35 15.07 8.35 15.36 8.64C15.65 8.93 15.65 9.41 15.36 9.7L13.06 12L15.36 14.3Z"})}),Ht=Vt,Jt=({variant:e="high",...t})=>g.jsx("svg",{fill:"currentColor",width:"1em",height:"1em",viewBox:"-1 0 19 19",...t,children:e==="mute"?g.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.05c0-.435-.252-.54-.56-.232L5.16 7.94H3.704a.794.794 0 0 0-.791.793v1.686a.794.794 0 0 0 .791.792h1.457l2.12 2.12c.308.308.56.204.56-.232zm3.84 3.524 1.49-1.49a.396.396 0 0 0-.56-.56l-1.49 1.49-1.49-1.49a.396.396 0 0 0-.56.56l1.49 1.49-1.49 1.49a.396.396 0 1 0 .56.56l1.49-1.49 1.49 1.49a.396.396 0 0 0 .56-.56z"}):e==="low"?g.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.06c0-.435-.252-.54-.56-.231l-2.12 2.12H3.705a.794.794 0 0 0-.792.792v1.686a.794.794 0 0 0 .792.792H5.16l2.12 2.12c.308.308.56.204.56-.231zm2.543 3.524a2.547 2.547 0 0 0-.75-1.813.396.396 0 1 0-.56.56 1.773 1.773 0 0 1 0 2.506.396.396 0 1 0 .56.56 2.546 2.546 0 0 0 .75-1.813z"}):e==="medium"?g.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.06c0-.435-.252-.54-.56-.231l-2.12 2.12H3.704a.794.794 0 0 0-.791.792v1.686a.794.794 0 0 0 .791.792h1.457l2.12 2.12c.308.308.56.204.56-.231zm1.792 5.337a2.564 2.564 0 0 0 0-3.626.396.396 0 1 0-.56.56 1.773 1.773 0 0 1 0 2.506.396.396 0 1 0 .56.56zm2.597-1.813a4.38 4.38 0 0 0-1.292-3.118.396.396 0 0 0-.56.56 3.618 3.618 0 0 1 0 5.116.396.396 0 1 0 .56.56 4.38 4.38 0 0 0 1.292-3.118z"}):e==="high"?g.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.06c0-.435-.252-.54-.56-.232l-2.12 2.12H3.704a.794.794 0 0 0-.791.792v1.687a.794.794 0 0 0 .791.792h1.457l2.12 2.12c.308.308.56.204.56-.232zm1.792 5.336a2.566 2.566 0 0 0 0-3.625.396.396 0 0 0-.56.56 1.775 1.775 0 0 1 0 2.506.396.396 0 1 0 .56.56zm1.305 1.305a4.41 4.41 0 0 0 0-6.235.396.396 0 0 0-.56.56 3.618 3.618 0 0 1 0 5.116.396.396 0 1 0 .56.56zm2.68-.764a6.25 6.25 0 0 0-1.375-6.776.396.396 0 1 0-.56.56 5.464 5.464 0 0 1 0 7.726.396.396 0 1 0 .56.56 6.216 6.216 0 0 0 1.374-2.07z"}):null}),qt=Jt;function Qt(){const{channel:e,setChannel:t,volume:s,setVolume:o,enableTimeout:r,setEnableTimeout:l,timeoutMultiplier:d,setTimeoutMultiplier:m,timeoutBase:f,setTimeoutBase:x}=V(),{isAuthenticated:c,goToLogin:k,logOut:b}=Ae();return g.jsxs("div",{className:"flex flex-col gap-2",children:[g.jsxs("fieldset",{children:[g.jsx("legend",{children:"Channel"}),g.jsx("input",{type:"text",name:"channel",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Nombre de twitch...",value:e,onChange:v=>t(v.target.value)})]}),g.jsxs("fieldset",{children:[g.jsx("legend",{children:"Bubble Sounds"}),g.jsxs("div",{className:"flex flex-row items-center gap-2 py-1",children:[g.jsx(qt,{className:"text-4xl",variant:s===0?"mute":s<.25?"low":s<.75?"medium":"high"}),g.jsx("input",{className:"accent-primary w-full",type:"range",min:0,max:1,step:.01,value:s,onChange:v=>o(parseFloat(v.target.value))}),g.jsxs("span",{className:"w-[5ch] text-end",children:[Math.round(s*100),"%"]})]})]}),c?g.jsxs(g.Fragment,{children:[g.jsxs("fieldset",{children:[g.jsx("legend",{children:"Enable Timeout"}),g.jsx("input",{className:"accent-primary",id:"enable-timeout",type:"checkbox",checked:r,onChange:v=>l(v.target.checked)})]}),r&&g.jsxs(g.Fragment,{children:[g.jsxs("fieldset",{children:[g.jsx("legend",{children:"Timeout Multiplier"}),g.jsx("input",{type:"number",name:"timeout-multiplier",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Timeout Multiplier",value:d,onChange:v=>{const n=Number(v.target.value),i=Number.isFinite(n),a=n>=0,w=Number.isInteger(n);i&&a&&w&&m(n)}})]}),g.jsxs("fieldset",{children:[g.jsx("legend",{children:"Timeout Base"}),g.jsx("input",{type:"number",name:"timeout-base",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Timeout Base",value:f,onChange:v=>{const n=Number(v.target.value),i=Number.isFinite(n),a=n>=0,w=Number.isInteger(n);i&&a&&w&&x(n)}})]})]}),g.jsx("button",{className:"w-full py-2 px-4 bg-primary text-white rounded-2xl",onClick:b,children:"LogOut"})]}):g.jsx("button",{className:"w-full py-2 px-4 bg-primary text-white rounded-2xl",onClick:k,children:"Login With Twitch"})]})}function Zt(){const e=V(r=>r.channel),[t,s]=A.useState(!e),o=()=>s(r=>!r);return g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"absolute bottom-0 right-0 border-2 border-primary p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-4lg outline-none",onClick:o,children:g.jsx(Wt,{})}),g.jsxs("div",{className:We("fixed bottom-0 right-0 bg-primary-dark w-screen h-screen z-20 transition-transform duration-200 flex justify-center items-center font-black",t?"translate-y-0 pointer-events-auto":"translate-y-full pointer-events-none"),children:[g.jsx("button",{className:"absolute top-2 right-2 border-2 border-primary text-primary p-2 rounded-lg",onClick:o,children:g.jsx(Ht,{})}),g.jsx(Qt,{})]})]})}var G=(e=>(e.IDLE="IDLE",e.STARTED="STARTED",e.GAME_OVER="GAME_OVER",e))(G||{});const Xt=Je(qe(e=>({status:"IDLE",number:0,user:"",maxScore:0,maxScoreUser:"",setGameState:t=>{e(t)}}),{name:"numerica",version:1})),Yt=Xt,{VITE_TWITCH_CLIENT_ID:Kt}={VITE_TWITCH_CLIENT_ID:"nb9w7hjhn6ypa159yatk09mua27slb",BASE_URL:"/numerica-rothio-skin/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},es=()=>{const{accessToken:e}=Re(),[t,s]=A.useState(!1),[o,r]=A.useState(null);return[A.useCallback(async({broadcasterId:d,moderatorId:m,userId:f,duration:x})=>{s(!0),r(null);try{console.log({broadcasterId:d,moderatorId:m,userId:f,duration:x});const c=new URL("https://api.twitch.tv/helix/moderation/bans");c.searchParams.append("broadcaster_id",d),c.searchParams.append("moderator_id",m);const k=await fetch(c.toString(),{method:"POST",headers:{"Content-Type":"application/json","Client-Id":Kt,Authorization:`Bearer ${e}`},body:JSON.stringify({data:{user_id:f,duration:x<1?1:x,reason:"Numerica Rothio Skin - Timeout"}})});if(!k.ok)throw new Error(k.statusText);return await k.json()}catch(c){r(c)}finally{s(!1)}},[]),{loading:t,error:o}]},ts=es,{VITE_TWITCH_CLIENT_ID:ss}={VITE_TWITCH_CLIENT_ID:"nb9w7hjhn6ypa159yatk09mua27slb",BASE_URL:"/numerica-rothio-skin/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},os=()=>{const{accessToken:e}=Re(),[t,s]=A.useState(!1),[o,r]=A.useState(null),[l,d]=A.useState(null);return[A.useCallback(async({username:f})=>{s(!0),r(null);try{const x=new URL("https://api.twitch.tv/helix/users");x.searchParams.append("login",f);const c=await fetch(x.toString(),{method:"GET",headers:{"Content-Type":"application/json","Client-Id":ss,Authorization:`Bearer ${e}`}});if(!c.ok)throw new Error(c.statusText);const b=(await c.json()).data[0];return d(b),b}catch(x){r(x)}finally{s(!1)}},[]),{loading:t,error:o,data:l}]},is=os,Ne=1e4,$e=4,ns=1e3,rs=40,Le=Array.from({length:8},(e,t)=>new Audio(`/bubble-${t}.mp3`));function cs(){const{isAuthenticated:e}=Ae(),t=V(u=>u.channel),s=V(u=>u.volume),o=V(u=>u.enableTimeout),r=V(u=>u.timeoutBase),l=V(u=>u.timeoutMultiplier),{status:d,number:m,user:f,maxScore:x,maxScoreUser:c,setGameState:k}=Yt(),[b,v]=A.useState(null),[n]=ts(),[i,{data:a}]=is(),w=A.useRef(null),p=A.useRef({duration:Ne,numberOfBubbles:$e,volume:s});A.useEffect(()=>{e&&i({username:t})},[]),A.useEffect(()=>{const u=new URL(window.location.href),T=new URLSearchParams(u.hash.substr(1)),N=T.get("maxScore"),S=T.get("maxScoreUser"),E=Number(N),C=isFinite(E),_=E%1===0,M=E>0;!N||!S||!C||!_||!M||E<x||k(()=>({maxScore:E,maxScoreUser:S}))},[]),A.useEffect(()=>{if(!t)return;const u=new pt.Client({channels:[t]});return u.connect().catch(console.error),v(u),()=>{u.disconnect().catch(console.error)}},[t]);const h=A.useCallback((u,T,N,S)=>{if(S)return;const E=T["user-id"],C=T.displayName||T.username,_=!!T.mod;if(!E||!C)return;const M=Number(N.replace(/[\D\W]+$/,"").replace(/^[\D\W]+/,"")),j=isFinite(M),O=M%1===0,q=M>0;!j||!O||!q||k(I=>I.status===G.STARTED&&I.user===C?{}:M===I.number+1?M>I.maxScore?{status:G.STARTED,number:I.number+1,user:C,maxScore:I.number+1,maxScoreUser:C}:{status:G.STARTED,number:I.number+1,user:C}:(e&&o&&(l||r)&&a&&!_&&I.number>0&&n({broadcasterId:a.id,moderatorId:a.id,userId:E,duration:r+I.number*l}),{status:I.number===0?G.IDLE:G.GAME_OVER,number:0,user:C}))},[k,n,e,o,l,r,a]);return A.useEffect(()=>{if(b)return b.on("message",h),()=>{b.removeListener("message",h)}},[b,h]),A.useEffect(()=>{const u=Te(0,m,50)/Te(5,x,50);p.current={duration:Math.round(Ee(Ne,ns,u)),numberOfBubbles:Math.round(Ee($e,rs,u)),volume:s}},[m,x,s]),A.useEffect(()=>{let u=null,T=0;const N=S=>{if(!w.current)return;const{duration:E,numberOfBubbles:C}=p.current;if(E/C<S-T){const j=Math.random()*Math.PI*2,O=Math.sin(j)*25+50,q=Math.cos(j)*25+50,I=document.createElement("div");I.classList.add("absolute"),I.classList.add("bg-white"),I.classList.add("rounded-full"),I.classList.add("top-1/2"),I.classList.add("left-1/2"),I.classList.add("-translate-y-1/2"),I.classList.add("-translate-x-1/2"),I.classList.add("animate-bubble"),I.style.setProperty("--target-top",`${O}%`),I.style.setProperty("--target-left",`${q}%`),I.style.setProperty("--animation-duration",`${E}ms`),w.current.appendChild(I),setTimeout(()=>{const{volume:z}=p.current;if(z>0){const W=Le[Math.floor(Math.random()*Le.length)];W.volume=z,W.play()}},Math.floor(E*.67)),setTimeout(()=>{var z;(z=w.current)==null||z.removeChild(I)},E),T=S}u=requestAnimationFrame(N)};return u=requestAnimationFrame(N),()=>{u&&cancelAnimationFrame(u)}},[]),g.jsxs("div",{className:"relative group",children:[g.jsxs("div",{className:"relative flex items-center justify-center w-[400px] h-[400px] rounded-full",children:[[m-1,m].map(u=>u<0?null:g.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 w-[200px] h-[200px] flex justify-center items-center bg-black p-4 rounded-full overflow-hidden mix-blend-screen contrast-[100]",children:g.jsx("span",{className:We("text-8xl font-bold leading-tight text-white blur-[1px]",u===m?"animate-bubble-fade-in":"animate-bubble-fade-out opacity-0"),children:u})},u)),g.jsxs("div",{className:"absolute -inset-[50%]",children:[g.jsx("div",{className:"absolute inset-0 bg-primary-circle"}),g.jsx("div",{className:"absolute inset-0 bg-black blur-lg contrast-[100] flex items-center justify-center mix-blend-multiply",ref:w,children:g.jsx("div",{className:"bg-white w-[200px] h-[200px] rounded-full"})})]})]}),g.jsxs("p",{className:"text-xl font-bold text-white bg-primary py-2 px-6 rounded-3xl absolute top-0 left-1/2 -translate-x-1/2 whitespace-nowrap text-center",children:["Max Score: ",x,c&&g.jsxs(g.Fragment,{children:[g.jsx("br",{}),"by ",c]})]}),(d===G.GAME_OVER||d===G.STARTED)&&g.jsx("p",{className:"text-xl font-bold text-white bg-primary py-2 px-6 rounded-3xl absolute bottom-0 left-1/2 -translate-x-1/2 whitespace-nowrap text-center",children:d===G.GAME_OVER?`Blame on ${f}!`:f}),g.jsx(Zt,{})]})}export{cs as default};
